{% extends 'base.html' %}

{% block content %}
    <div style="display:flex;gap:16px">
        <div style="flex:1">
            <div class="card">
                <h3>Faculty Actions</h3>
                <form method="post" action="{{ url_for('faculty_update') }}">
                                        <label>Search student (username or bluegoldID):</label><br />
                                        <input name="target" style="width:60%" value="{% if student %}{{ student['username'] }}{% endif %}" />
                                        {% if student %}
                                            <input type="hidden" name="student_id" value="{{ student['id'] }}" />
                                        {% endif %}
                    <button type="submit" name="action" value="search">Search</button>
                    <button type="submit" name="action" value="list" style="margin-left:8px">List All Students</button>

                    {% if student %}
                        <hr />
                        <h4>Student: {{ student['username'] }} — {{ student['name'] }}</h4>
                        <p class="muted">Last updated: {{ student['updated_at'] }}</p>
                        <label>GPA</label><br />
                        <input name="gpa" value="{{ student['gpa'] }}" style="width:120px" />
                        <label style="margin-left:8px">Total credits</label>
                        <input name="total_credits" value="{{ student['total_credits'] }}" style="width:120px" />
                        <div style="margin-top:8px">
                            <button type="submit" name="action" value="update_academic">Update Academics</button>
                        </div>

                        <hr />
                        <p>Balance: ${{ '%.2f'|format(student['balance'] or 0.0) }}</p>
                        <label>Charge amount ($)</label>
                        <input name="amount" style="width:120px" />
                        <button type="submit" name="action" value="charge_tuition">Charge</button>

                        <div style="margin-top:8px">
                            <label>Set absolute balance ($)</label>
                            <input name="new_balance" style="width:120px" />
                            <button type="submit" name="action" value="set_balance">Set Balance</button>
                        </div>
                    {% endif %}
                </form>
            </div>

            <div class="card" style="margin-top:12px">
                <h3>Students</h3>
                {% if request.method=='POST' and not student %}
                    <p class="muted">No student selected.</p>
                {% endif %}
                {% if students %}
                    <table>
                        <thead><tr><th>Username</th><th>Name</th><th>GPA</th><th>Balance</th></tr></thead>
                        <tbody>
                            {% for s in students %}
                                <tr>
                                    <td>{{ s['username'] }}</td>
                                    <td>{{ s['name'] or '' }}</td>
                                    <td>{{ s['gpa'] }}</td>
                                    <td>${{ '%.2f'|format(s['balance'] or 0.0) }}</td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                {% else %}
                    <p class="muted">No students found.</p>
                {% endif %}
            </div>
        </div>

        <div style="width:360px">
            <div class="card">
                <h3>Recent transactions</h3>
                {% if transactions %}
                    <ul>
                    {% for t in transactions %}
                        <li class="muted">[{{ t['timestamp'] }}] <strong>{{ t['actor_username'] }}</strong> — {{ t['action'] }} — {{ t['details'] }}</li>
                    {% endfor %}
                    </ul>
                {% else %}
                    <p class="muted">No recent transactions.</p>
                {% endif %}
            </div>
        </div>
    </div>
{% endblock %}